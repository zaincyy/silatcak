<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Livescore Pencak Silat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .btn-primary {
            background-color: #1e40af;
            color: white;
        }
        .btn-primary:hover {
            background-color: #1d4ed8;
        }
        .btn-danger {
            background-color: #b91c1c;
            color: white;
        }
        .btn-danger:hover {
            background-color: #dc2626;
        }
        .btn-secondary {
            background-color: #4b5563;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #6b7280;
        }
        .btn-warning {
            background-color: #f59e0b;
            color: white;
        }
        .btn-warning:hover {
            background-color: #fbbF04;
        }
        .hidden {
            display: none;
        }
        .pesilat-merah {
            background: linear-gradient(135deg, #ef4444, #b91c1c);
            color: white;
        }
        .pesilat-biru {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }
        .notification-banner {
            animation: fadeInOut 10s ease-in-out forwards;
        }
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; transform: translateY(-20px); }
            10%, 90% { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="app">
        <!-- Semua halaman akan dirender di sini oleh JavaScript -->
    </div>

    <script>
        // IMAGE ICONS
        const PUKULAN_ICON_SOLID = `https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgzH_IQ00ML2WmxBVDDjB8MZ61J5At7mQoOcCF48YP7Z_opzkiJHmDtcigQGNKDXoh5IuNqsrJLKw2mBnClYeHn2Gz49OQuKPF_-CXwvQw_YflbBZiGA45VvaF15-4P5DOSHqexOLTua4NVxeCvFsOVplar3FWieGSZ468XrfgUHIMS-2X9mH77UVGP0g/s1000/1000140690.png`;
        const TENDANGAN_ICON_SOLID = `https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjGMdEBMmP9Oe_peFEcmV3oIglmioQPrJ8d0IQr8oZSYzr6wtro_gmSY5C6Y60qcBLlfeAW0y9y1eatvnoVTgS8CMFifU7w-2yD0hxB1Vn1qC361BMjJITuiYc2b6GwZR33JqbM2CvWmUf8q7KvaxAufCCAUjg-voVPehN2UVEVujbrw-ZNg2jL-v8gcA/s1000/1000140691.png`;
        const DISKUALIFIKASI_ICON_SOLID = `https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjMVU6OsARlKY0um39JZmV3tyh94kM2o86USqSRK0aqZxP5iMkjzPTKv7gB8cu3UOtnjJPvPdSAL0Ft0UulWf6ZaXRpiyNzl7aj-roirNyfIkjvna0u6hFiKU9Vd5fk3jEgFl-ft-thyphenhyphen1r9YDRkFnNG-KYe-BLXDzEsbrkn-sYoACLwEFnAoDh_OlAlqQ/s1000/1000140692.png`;
        const JATUHAN_ICON_SOLID = `https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjfQJmWxTH0Yyiz2xFfQbEMiZoPZArCjiqq_e5luAhqaVj1zKNmv64Vz7Y_JcZMz9qIssaqanHCX13sxUML9Zq0uF-jjkjESY9sPfKfNNRT4VKmbIU4EthAICV0aSIjuMVe5QKMxL8-lX592nCOahgXneGPg0OPDwwK9YH6CA6F6v8w26UR2oj_99Bpvw/s1000/1000140699.png`;
        
        const PENALTY_ICONS = {
            Binaan: [
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgkhRfjKAXxm21odN9F14R6sk5mo9W8yHarsD5U14GEMq23QXxjy3vERSLFSvgFxGUbEWDpe_EQs4fRYD5gZZMpdTJ1DY90ghPe1PZZOw_AqljJ84a5NbtdCRj3rE1XY9w5U0JFW9UcNBHp-E_YRiWprRuxighuEyjelPpqEg-kVwZhEVtK1_jDlvF8cA/s1000/1000140693.png',
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjluCxCZB231Nd9XtRBadIh4tdru-cSBkHPNqXoqhYm5Xpj-DcVlfaTdRBylFsn7fV-1tgYC3zdIoxaDram1AqxxBCXJ6VzDgDdTlend2Lm2s605nwzYyXrYRuQiRRA-JkpYK8JtEKBXLdHofV-NfO4YcXlF6B4IytZw1-pdatJ4W0EMQkI6H1YSTK5Ow/s1000/1000140696.png'
            ],
            Teguran: [
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjQWnSAiETasi05FGkgCxtBlDTTSiENqCUiJfQGlpegvT3evLBYxu3srfAIWGzoEp7FYc256iVFztp-NsRQY5L4vUswFKnOVCnnRT6GmBntyxV9C7nfa9qYf-hbfAaDFPU-mfYEyntEeZkiHDGhO_g_dmbHu72iPr0ZvxE2JkoZN8vL8W-Tr6JoWu8xVQ/s1000/1000140694.png',
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi7VDWzJOo4ajXyp-sANMBbgODnXMje8TMerykiQcBMTzxNtbDwEJ0Y3pTw4RF47tgT80MAzD7MUeuw-Fu6va96Ekw2CKzErAcWuVQR0CaSXahy1mExUhDJ6P0e5kBd037LfEuWeBe7mSZY7g-ixVm5xxCAaTJb1IYiUdQ_wcl8Etyp-LPGnZBRIxDaiA/s1000/1000140697.png'
            ],
            Pelanggaran: [
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgi403GzGhjWCXLUfx9yjUrn1jGUll6BfJLASQL0sTeLvS3JQl-rhWo84qaSuS4OJBW1faUe3Sj1Wopp6Rpl6DlfWpkjkloohcs6Bkh7PvwItAZlSHAxKjnJAOQdBFNTrCrshfLdxD5uRBqtAYAmjp1vtZqqx19dY0eOHE9q2vQEcA4tzRYPhD2KO2hkg/s1000/1000140695.png',
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiN9CMQ1x1q7g35xWaIfYbaWrW3__0sLkvCS2rvo4jliRFE8D-fqjW7B5guQbumiJmghJpg05ZFWq596T0rSKwAw_681nuWMnBbInSxlCoXe45ybKP9HMBTHeu2bDKD7z_7HIT7HrpDvujUxWgEfDNRGm9_qNKDyYn7GopLEeN-tZFSOuRZ05NG6a9-A/s1000/1000140698.png'
            ]
        };

        const App = {
            data: {
                match: { name: 'PARTAI FINAL KELAS A PUTRA', pesilatMerah: { name: 'PESILAT SUDUT MERAH', perguruan: 'PERGURUAN A' }, pesilatBiru: { name: 'PESILAT SUDUT BIRU', perguruan: 'PERGURUAN B' } },
                timer: { initialTime: 180, time: 180, isRunning: false, intervalId: null },
                scores: { juri1: { merah: 0, biru: 0 }, juri2: { merah: 0, biru: 0 }, juri3: { merah: 0, biru: 0 } },
                dewan: { lastAction: null, history: [] },
                ketua: { winner: null },
                operator: { runningText: 'SELAMAT DATANG DI ARENA PERTANDINGAN PENCAK SILAT' },
                users: { operators: [{ username: 'operator01', pass: '123' }] },
                pesertaList: [{ name: 'Iko Uwais', perguruan: 'Tiga Berantai' }, { name: 'Yayan Ruhian', perguruan: 'Pencak Silat Tenaga Dasar' }, { name: 'Cecep Arif Rahman', perguruan: 'Panglipur' }]
            },
            init() { this.loadData(); this.router(); window.addEventListener('hashchange', () => this.router()); window.addEventListener('storage', (e) => { if (e.key === 'silat_livescore') { this.loadData(); this.render(); } }); },
            router() { const path = window.location.hash || '#dashboard'; const page = path.split('/')[0]; const param = path.split('/')[1]; this.currentPage = page; this.param = param; this.render(); },
            render() {
                const appContainer = document.getElementById('app');
                appContainer.innerHTML = '';
                let pageContent = '';
                switch (this.currentPage) {
                    case '#operator': pageContent = this.renderOperatorPage(); break;
                    case '#juri': pageContent = this.renderJuriPage(this.param); break;
                    case '#dewan': pageContent = this.renderDewanPage(); break;
                    case '#ketua': pageContent = this.renderKetuaPage(); break;
                    case '#papan-skor': pageContent = this.renderPapanSkorPage(); break;
                    case '#admin': pageContent = this.renderAdminPage(); break;
                    default: pageContent = this.renderDashboard();
                }
                appContainer.innerHTML = pageContent;
                this.attachEventListeners();
            },
            renderDashboard() { 
                return `
                    <div class="text-center mb-8">
                        <h1 class="text-4xl font-bold text-gray-800">Portal Livescore</h1>
                        <p class="text-gray-600">Pilih peran Anda untuk melanjutkan</p>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 max-w-6xl mx-auto">
                        <a href="#operator" class="card text-center hover:shadow-xl hover:-translate-y-1"><i class="fa-solid fa-sliders text-5xl text-green-600 mb-4"></i><h2 class="text-xl font-bold">Operator</h2></a>
                        <a href="#ketua" class="card text-center hover:shadow-xl hover:-translate-y-1"><i class="fa-solid fa-gavel text-5xl text-purple-600 mb-4"></i><h2 class="text-xl font-bold">Ketua Pertandingan</h2></a>
                        <a href="#dewan" class="card text-center hover:shadow-xl hover:-translate-y-1"><i class="fa-solid fa-book-open text-5xl text-yellow-600 mb-4"></i><h2 class="text-xl font-bold">Dewan</h2></a>
                        <a href="#juri/1" class="card text-center hover:shadow-xl hover:-translate-y-1"><i class="fa-solid fa-user-tie text-5xl text-red-600 mb-4"></i><h2 class="text-xl font-bold">Juri 1</h2></a>
                        <a href="#juri/2" class="card text-center hover:shadow-xl hover:-translate-y-1"><i class="fa-solid fa-user-tie text-5xl text-red-600 mb-4"></i><h2 class="text-xl font-bold">Juri 2</h2></a>
                        <a href="#juri/3" class="card text-center hover:shadow-xl hover:-translate-y-1"><i class="fa-solid fa-user-tie text-5xl text-red-600 mb-4"></i><h2 class="text-xl font-bold">Juri 3</h2></a>
                        <a href="#papan-skor" target="_blank" class="card text-center hover:shadow-xl hover:-translate-y-1 col-span-2 md:col-span-1 lg:col-span-1"><i class="fa-solid fa-tv text-5xl text-gray-700 mb-4"></i><h2 class="text-xl font-bold">Papan Skor Publik</h2></a>
                    </div>
                `; 
            },
            renderAdminPage() { let operatorList = this.data.users.operators.map((op, index) => `<tr class="border-b"><td class="p-2">${op.username}</td><td class="p-2">******</td><td class="p-2"><button class="btn btn-danger text-sm" data-action="deleteOperator" data-index="${index}">Hapus</button></td></tr>`).join(''); return `<a href="#dashboard" class="text-blue-600 mb-4 inline-block"><i class="fas fa-arrow-left"></i> Kembali ke Dashboard</a><h1 class="text-3xl font-bold mb-4">Admin: Manajemen Operator</h1><div class="grid md:grid-cols-2 gap-8"><div class="card"><h2 class="text-2xl font-semibold mb-4">Tambah Operator Baru</h2><div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700">Username</label><input id="newOpUsername" type="text" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></div><div><label class="block text-sm font-medium text-gray-700">Password</label><input id="newOpPass" type="password" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></div><button class="btn btn-primary w-full" data-action="addOperator">Tambah</button></div></div><div class="card"><h2 class="text-2xl font-semibold mb-4">Daftar Operator</h2><table class="w-full text-left"><thead><tr class="border-b"><th class="p-2">Username</th><th class="p-2">Password</th><th class="p-2">Aksi</th></tr></thead><tbody>${operatorList}</tbody></table></div></div>`; },
            renderOperatorPage() {
                const { name, pesilatMerah, pesilatBiru } = this.data.match;
                const { time, isRunning, initialTime } = this.data.timer;
                const { runningText } = this.data.operator;
                const minutes = Math.floor(time / 60).toString().padStart(2, '0');
                const seconds = (time % 60).toString().padStart(2, '0');
                const initialMinutes = Math.floor(initialTime / 60);
                const initialSeconds = initialTime % 60;
                let pesertaRows = this.data.pesertaList.map((p, index) => `
                    <tr class="border-b"><td class="p-2">${p.name}</td><td class="p-2">${p.perguruan}</td><td class="p-2"><button data-action="deletePeserta" data-index="${index}" class="text-red-500 hover:text-red-700"><i class="fas fa-trash"></i></button></td></tr>
                `).join('');

                return `
                    <a href="#dashboard" class="text-blue-600 mb-4 inline-block"><i class="fas fa-arrow-left"></i> Kembali ke Dashboard</a>
                    <h1 class="text-3xl font-bold mb-6">Panel Operator</h1>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="card lg:col-span-1"><h2 class="text-xl font-semibold mb-4">Pengaturan Pertandingan</h2><div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700">Nama Pertandingan</label><input type="text" id="matchName" value="${name}" data-key="match.name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></div><div><label class="block text-sm font-medium text-gray-700">Nama Pesilat Merah</label><input type="text" id="pesilatMerahName" value="${pesilatMerah.name}" data-key="match.pesilatMerah.name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></div><div><label class="block text-sm font-medium text-gray-700">Perguruan Merah</label><input type="text" id="pesilatMerahPerguruan" value="${pesilatMerah.perguruan}" data-key="match.pesilatMerah.perguruan" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></div><div><label class="block text-sm font-medium text-gray-700">Nama Pesilat Biru</label><input type="text" id="pesilatBiruName" value="${pesilatBiru.name}" data-key="match.pesilatBiru.name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></div><div><label class="block text-sm font-medium text-gray-700">Perguruan Biru</label><input type="text" id="pesilatBiruPerguruan" value="${pesilatBiru.perguruan}" data-key="match.pesilatBiru.perguruan" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"></div></div></div>
                        <div class="card lg:col-span-1 text-center"><h2 class="text-xl font-semibold mb-4">Kontrol Waktu</h2><div class="text-7xl font-bold my-6">${minutes}:${seconds}</div><div class="flex justify-center space-x-4"><button data-action="timerPlay" class="btn btn-primary ${isRunning ? 'hidden' : ''}"><i class="fas fa-play"></i> Play</button><button data-action="timerPause" class="btn btn-secondary ${!isRunning ? 'hidden' : ''}"><i class="fas fa-pause"></i> Pause</button><button data-action="timerReset" class="btn btn-danger"><i class="fas fa-sync"></i> Reset</button></div><div class="mt-6 border-t pt-4"><h3 class="text-lg font-semibold mb-2">Atur Waktu Pertandingan</h3><div class="flex items-center justify-center space-x-2 text-black"><input type="number" id="customMinutes" class="w-20 p-2 text-center border rounded" value="${initialMinutes}"><span class="font-bold text-gray-700">:</span><input type="number" id="customSeconds" class="w-20 p-2 text-center border rounded" value="${initialSeconds}"></div><button data-action="setCustomTime" class="btn btn-primary w-full mt-3">Set Waktu</button></div></div>
                        <div class="card lg:col-span-1"><h2 class="text-xl font-semibold mb-4">Pengaturan Lain</h2><div><label class="block text-sm font-medium text-gray-700">Running Text</label><textarea id="runningText" data-key="operator.runningText" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">${runningText}</textarea></div><div class="mt-6"><h3 class="text-lg font-semibold">Reset Data</h3><p class="text-sm text-gray-500 mb-2">Mengatur ulang semua skor dan status pertandingan.</p><button data-action="resetAll" class="btn btn-warning w-full">Reset Pertandingan</button></div></div>
                    </div>
                    <div class="card mt-6">
                        <h2 class="text-2xl font-semibold mb-4">Manajemen Peserta & Pertandingan</h2>
                        <div class="grid lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-1">
                                <h3 class="text-xl font-semibold mb-2">Tambah Peserta</h3>
                                <div class="space-y-2 mb-4">
                                    <input id="pesertaName" type="text" placeholder="Nama Pesilat" class="w-full rounded-md border-gray-300 p-2">
                                    <input id="pesertaPerguruan" type="text" placeholder="Nama Perguruan" class="w-full rounded-md border-gray-300 p-2">
                                    <button data-action="addPeserta" class="btn btn-primary w-full">Tambah Peserta</button>
                                </div>
                            </div>
                            <div class="lg:col-span-1">
                                <h3 class="text-xl font-semibold mb-2">Daftar Peserta</h3>
                                <div class="h-48 overflow-y-auto border rounded-lg p-2">
                                    <table class="w-full text-left text-sm">
                                        <thead><tr class="border-b"><th class="p-2">Nama</th><th class="p-2">Perguruan</th><th class="p-2">Aksi</th></tr></thead>
                                        <tbody>${pesertaRows}</tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="lg:col-span-1">
                                <h3 class="text-xl font-semibold mb-2">Pertandingan</h3>
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <p class="text-sm text-gray-500 mb-2">Pilih 2 peserta acak dari daftar dan atur sebagai pertandingan saat ini.</p>
                                    <button data-action="acakPertandingan" class="btn btn-secondary w-full">Acak Pertandingan!</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            },
            renderJuriPage(juriId) {
                if (!['1', '2', '3'].includes(juriId)) { return `<div class="card text-center"><h1 class="text-2xl text-red-600">Juri tidak valid.</h1><a href="#dashboard" class="text-blue-600 mt-4 inline-block">Kembali</a></div>`; }
                
                const juriKey = `juri${juriId}`;
                const { dewan, timer } = this.data;
                const minutes = Math.floor(timer.time / 60).toString().padStart(2, '0');
                const seconds = (timer.time % 60).toString().padStart(2, '0');

                let dewanVerificationUI = '';
                const lastAction = dewan.lastAction;

                if (lastAction && !lastAction.forwardToKetua && lastAction.juriVotes && lastAction.juriVotes[juriKey] === null) {
                    dewanVerificationUI = `<div class="mb-8"><div class="bg-blue-600 text-white p-3 rounded-t-lg text-xl font-bold">Apakah yang di berikan dewan benar?</div><div class="flex"><button data-action="juriVerifyDewan" data-juri="${juriKey}" data-vote="yes" class="flex-1 bg-black text-white p-3 text-2xl font-bold rounded-bl-lg hover:bg-gray-700">YA</button><button data-action="juriVerifyDewan" data-juri="${juriKey}" data-vote="no" class="flex-1 bg-black text-white p-3 text-2xl font-bold rounded-br-lg hover:bg-gray-700">TIDAK</button></div></div>`;
                }

                return `
                    <div class="max-w-md mx-auto text-center p-4">
                        <a href="#dashboard" class="text-blue-600 mb-4 inline-block">Kembali ke Dashboard</a>
                        ${dewanVerificationUI}
                        <div class="grid grid-cols-2 gap-4">
                            <button data-action="addScore" data-juri="${juriKey}" data-pesilat="merah" data-value="1" class="bg-red-500 rounded-lg p-4 transform transition-transform hover:scale-105"><img src="${PUKULAN_ICON_SOLID}" class="h-24 w-24 mx-auto"></button>
                            <button data-action="addScore" data-juri="${juriKey}" data-pesilat="merah" data-value="2" class="bg-red-500 rounded-lg p-4 transform transition-transform hover:scale-105"><img src="${TENDANGAN_ICON_SOLID}" class="h-24 w-24 mx-auto"></button>
                            <button data-action="addScore" data-juri="${juriKey}" data-pesilat="biru" data-value="1" class="bg-blue-500 rounded-lg p-4 transform transition-transform hover:scale-105"><img src="${PUKULAN_ICON_SOLID}" class="h-24 w-24 mx-auto"></button>
                            <button data-action="addScore" data-juri="${juriKey}" data-pesilat="biru" data-value="2" class="bg-blue-500 rounded-lg p-4 transform transition-transform hover:scale-105"><img src="${TENDANGAN_ICON_SOLID}" class="h-24 w-24 mx-auto"></button>
                        </div>
                        <div class="mt-8 text-6xl font-black text-gray-800">${minutes}:${seconds}</div>
                    </div>
                `;
            },
            renderDewanPage() {
                const { timer } = this.data;
                const minutes = Math.floor(timer.time / 60).toString().padStart(2, '0');
                const seconds = (timer.time % 60).toString().padStart(2, '0');

                return `
                    <div class="max-w-md mx-auto text-center p-4">
                        <a href="#dashboard" class="text-blue-600 mb-4 inline-block">Kembali ke Dashboard</a>
                        <div class="mb-8 text-6xl font-black text-gray-800">${minutes}:${seconds}</div>
                        <div class="space-y-3 mb-6">
                            <div class="grid grid-cols-3 gap-3">
                                <button data-action="dewanAction" data-pesilat="merah" data-type="Binaan" class="bg-red-500 text-white rounded-lg p-4 text-4xl font-bold transform transition-transform hover:scale-105">B</button>
                                <button data-action="dewanAction" data-pesilat="merah" data-type="Pelanggaran" class="bg-red-500 text-white rounded-lg p-4 text-4xl font-bold transform transition-transform hover:scale-105">P</button>
                                <button data-action="dewanAction" data-pesilat="merah" data-type="Teguran" class="bg-red-500 text-white rounded-lg p-4 text-4xl font-bold transform transition-transform hover:scale-105">T</button>
                            </div>
                            <button data-action="dewanAction" data-pesilat="merah" data-type="Jatuhan" class="w-full bg-red-500 text-white rounded-lg p-4 text-3xl font-bold transform transition-transform hover:scale-105">JATUHAN</button>
                        </div>
                        <div class="space-y-3 mb-8">
                            <div class="grid grid-cols-3 gap-3">
                                <button data-action="dewanAction" data-pesilat="biru" data-type="Binaan" class="bg-blue-500 text-white rounded-lg p-4 text-4xl font-bold transform transition-transform hover:scale-105">B</button>
                                <button data-action="dewanAction" data-pesilat="biru" data-type="Pelanggaran" class="bg-blue-500 text-white rounded-lg p-4 text-4xl font-bold transform transition-transform hover:scale-105">P</button>
                                <button data-action="dewanAction" data-pesilat="biru" data-type="Teguran" class="bg-blue-500 text-white rounded-lg p-4 text-4xl font-bold transform transition-transform hover:scale-105">T</button>
                            </div>
                            <button data-action="dewanAction" data-pesilat="biru" data-type="Jatuhan" class="w-full bg-blue-500 text-white rounded-lg p-4 text-3xl font-bold transform transition-transform hover:scale-105">JATUHAN</button>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <button data-action="dewanAction" data-pesilat="merah" data-type="Diskualifikasi" class="bg-red-500 rounded-lg p-4 transform transition-transform hover:scale-105"><img src="${DISKUALIFIKASI_ICON_SOLID}" class="h-16 w-16 mx-auto"></button>
                            <button data-action="dewanAction" data-pesilat="biru" data-type="Diskualifikasi" class="bg-blue-500 rounded-lg p-4 transform transition-transform hover:scale-105"><img src="${DISKUALIFIKASI_ICON_SOLID}" class="h-16 w-16 mx-auto"></button>
                        </div>
                    </div>
                `;
            },
            renderKetuaPage() {
                const { match, scores, timer, dewan } = this.data;
                const totalMerah = scores.juri1.merah + scores.juri2.merah + scores.juri3.merah;
                const totalBiru = scores.juri1.biru + scores.juri2.biru + scores.juri3.biru;
                const minutes = Math.floor(timer.time / 60).toString().padStart(2, '0');
                const seconds = (timer.time % 60).toString().padStart(2, '0');
                const penalties = { merah: { Binaan: 0, Pelanggaran: 0, Teguran: 0, Jatuhan: 0, Diskualifikasi: 0 }, biru: { Binaan: 0, Pelanggaran: 0, Teguran: 0, Jatuhan: 0, Diskualifikasi: 0 } };
                dewan.history.forEach(action => {
                    if (action.verified && penalties[action.pesilat] && penalties[action.pesilat][action.type] !== undefined) {
                        penalties[action.pesilat][action.type]++;
                    }
                });
                
                let dewanVerificationUI = `<div class="bg-black text-white p-3 rounded-lg text-center"><p>Tidak ada aksi dari dewan</p></div>`;
                if (dewan.lastAction && !dewan.lastAction.verified && dewan.lastAction.forwardToKetua) {
                    dewanVerificationUI = `<div class="bg-black text-white p-3 rounded-lg text-center"><p class="mb-2">Apakah yang di berikan dewan benar?</p><p class="font-bold text-yellow-400">${dewan.lastAction.type} untuk ${dewan.lastAction.pesilat.toUpperCase()}</p><button data-action="verifyDewanAction" class="bg-green-500 text-white font-bold py-1 px-4 rounded-full mt-2">Verifikasi</button></div>`;
                }

                return `
                    <div class="max-w-4xl mx-auto">
                        <a href="#dashboard" class="text-blue-600 mb-4 inline-block">Kembali ke Dashboard</a>
                        <div class="grid md:grid-cols-2 gap-8">
                            <!-- Kolom Kiri: Penentuan Pemenang -->
                            <div class="card text-center">
                                <div class="flex justify-center items-center space-x-2 mb-4">
                                    <div class="bg-red-500 text-white p-4 rounded-lg text-3xl font-bold w-1/3">${totalMerah}</div>
                                    <div class="bg-black text-white p-2 rounded-full text-lg font-bold">Ronde 1</div>
                                    <div class="bg-blue-500 text-white p-4 rounded-lg text-3xl font-bold w-1/3">${totalBiru}</div>
                                </div>
                                <h2 class="text-xl font-bold mb-3">Tentukan Pemenang !!</h2>
                                <div class="space-y-3">
                                    <button data-action="setWinner" data-winner="merah" class="w-full bg-red-500 text-white p-3 rounded-full text-lg font-bold hover:bg-red-600">${match.pesilatMerah.name}</button>
                                    <button data-action="setWinner" data-winner="biru" class="w-full bg-blue-500 text-white p-3 rounded-full text-lg font-bold hover:bg-blue-600">${match.pesilatBiru.name}</button>
                                    <button data-action="setWinner" data-winner="seri" class="w-full bg-black text-white p-3 rounded-full text-lg font-bold hover:bg-gray-700">SERI</button>
                                </div>
                            </div>

                            <!-- Kolom Kanan: Kontrol & Info -->
                            <div class="card text-center">
                                <div class="flex justify-center items-center space-x-4 mb-3">
                                    <span class="text-6xl font-black text-gray-800">${minutes}:${seconds}</span>
                                    <button data-action="${timer.isRunning ? 'timerPause' : 'timerPlay'}" class="bg-black text-white rounded-full h-14 w-14 flex items-center justify-center text-2xl"><i class="fas ${timer.isRunning ? 'fa-pause' : 'fa-play'}"></i></button>
                                </div>
                                <button data-action="timerReset" class="w-full bg-green-500 text-white p-2 rounded-full font-bold mb-4 hover:bg-green-600">RESET WAKTU</button>

                                <div class="flex space-x-2 text-white text-lg font-bold">
                                    <div class="bg-red-500 flex-1 p-2 rounded-l-lg">
                                        <p>B: ${penalties.merah.Binaan}</p><p>P: ${penalties.merah.Pelanggaran}</p><p>T: ${penalties.merah.Teguran}</p>
                                        <div class="flex justify-center items-center mt-1"><img src="${JATUHAN_ICON_SOLID}" class="h-6 w-6 mr-1">${penalties.merah.Jatuhan}</div>
                                        <div class="flex justify-center items-center mt-1"><img src="${DISKUALIFIKASI_ICON_SOLID}" class="h-6 w-6 mr-1">${penalties.merah.Diskualifikasi}</div>
                                    </div>
                                    <div class="bg-blue-500 flex-1 p-2 rounded-r-lg">
                                        <p>B: ${penalties.biru.Binaan}</p><p>P: ${penalties.biru.Pelanggaran}</p><p>T: ${penalties.biru.Teguran}</p>
                                        <div class="flex justify-center items-center mt-1"><img src="${JATUHAN_ICON_SOLID}" class="h-6 w-6 mr-1">${penalties.biru.Jatuhan}</div>
                                        <div class="flex justify-center items-center mt-1"><img src="${DISKUALIFIKASI_ICON_SOLID}" class="h-6 w-6 mr-1">${penalties.biru.Diskualifikasi}</div>
                                    </div>
                                </div>
                                <div class="mt-4">${dewanVerificationUI}</div>
                            </div>
                        </div>
                    </div>
                `;
            },
            renderPenaltyIcons(penaltyCounts) {
                let html = '';
                const types = ['Binaan', 'Teguran', 'Pelanggaran'];
                types.forEach(type => {
                    const count = penaltyCounts[type];
                    if (count === 1) {
                        html += `<img src="${PENALTY_ICONS[type][0]}" class="h-8 md:h-12 object-contain" alt="${type} 1">`;
                    } else if (count >= 2) {
                        html += `<img src="${PENALTY_ICONS[type][1]}" class="h-8 md:h-12 object-contain" alt="${type} 2">`;
                    } else {
                        html += `<div class="w-8 md:w-12"></div>`; // Placeholder
                    }
                });
                return html;
            },
            renderPapanSkorPage() {
                const { match, scores, timer, operator, dewan, ketua } = this.data;
                const totalMerah = scores.juri1.merah + scores.juri2.merah + scores.juri3.merah;
                const totalBiru = scores.juri1.biru + scores.juri2.biru + scores.juri3.biru;
                const minutes = Math.floor(timer.time / 60).toString().padStart(2, '0');
                const seconds = (timer.time % 60).toString().padStart(2, '0');
                const penalties = { merah: { Binaan: 0, Teguran: 0, Pelanggaran: 0 }, biru: { Binaan: 0, Teguran: 0, Pelanggaran: 0 } };
                dewan.history.forEach(action => { if (action.verified && penalties[action.pesilat] && penalties[action.pesilat][action.type] !== undefined) { penalties[action.pesilat][action.type]++; } });
                let dewanNotification = '';
                if (dewan.lastAction && dewan.lastAction.verified) { dewanNotification = `<div class="notification-banner absolute top-4 left-1/2 -translate-x-1/2 bg-yellow-400 text-black font-bold p-4 rounded-lg shadow-lg z-50 text-2xl">DEWAN: PESILAT ${dewan.lastAction.pesilat.toUpperCase()} - ${dewan.lastAction.type}</div>`; }
                let winnerOverlay = '';
                if (ketua.winner) {
                    const winnerData = ketua.winner === 'merah' ? match.pesilatMerah : (ketua.winner === 'biru' ? match.pesilatBiru : { name: 'HASIL SERI', perguruan: '' });
                    const winnerColor = ketua.winner === 'merah' ? 'bg-red-600' : (ketua.winner === 'biru' ? 'bg-blue-600' : 'bg-gray-700');
                    winnerOverlay = `<div class="absolute inset-0 bg-black/80 flex flex-col justify-center items-center z-40 text-white"><h2 class="text-5xl font-bold mb-8">Pertandingan Selesai</h2><div class="text-center p-8 rounded-lg ${winnerColor} w-3/4 md:w-1/2"><p class="text-3xl">${ketua.winner !== 'seri' ? 'Pemenang' : ''}</p><h1 class="text-7xl font-black my-4">${winnerData.name}</h1><p class="text-3xl">${winnerData.perguruan}</p></div><button data-action="closeWinner" class="btn btn-secondary mt-8 text-2xl">Tutup</button></div>`;
                }
                return `
                    <div id="fullscreen-container" class="min-h-screen bg-black text-white flex flex-col p-2 md:p-4 font-sans relative">
                        ${dewanNotification}${winnerOverlay}
                        <button data-action="toggleFullscreen" class="absolute top-2 right-2 bg-gray-700/50 hover:bg-gray-600/50 text-white rounded-full h-10 w-10 flex items-center justify-center z-50"><i class="fas fa-expand"></i></button>
                        <div class="w-full text-center py-2 text-xl md:text-2xl font-bold border-b-2 border-white overflow-hidden"><p class="whitespace-nowrap animate-marquee">${operator.runningText}</p></div>
                        <div class="grid grid-cols-11 items-center text-center my-2 md:my-4 gap-2">
                            <div class="col-span-5 bg-red-600 p-2 md:p-4 rounded-lg"><h2 class="text-lg sm:text-2xl md:text-4xl font-bold">${match.pesilatMerah.perguruan}</h2><p class="text-base sm:text-xl md:text-3xl">${match.pesilatMerah.name}</p></div>
                            <div class="col-span-1 text-4xl sm:text-6xl md:text-8xl font-black">VS</div>
                            <div class="col-span-5 bg-blue-600 p-2 md:p-4 rounded-lg"><h2 class="text-lg sm:text-2xl md:text-4xl font-bold">${match.pesilatBiru.perguruan}</h2><p class="text-base sm:text-xl md:text-3xl">${match.pesilatBiru.name}</p></div>
                        </div>
                        <div class="flex-grow grid grid-cols-11 gap-2 md:gap-4 items-center">
                            <div class="col-span-3 h-full flex justify-around items-center bg-black border-2 border-white rounded-lg p-2">${this.renderPenaltyIcons(penalties.merah)}</div>
                            <div class="col-span-2 bg-red-600 h-full flex justify-center items-center rounded-lg"><span class="text-6xl sm:text-8xl md:text-9xl font-black">${totalMerah}</span></div>
                            <div class="col-span-1 h-full flex justify-center items-center"><div class="bg-gray-800 text-yellow-300 w-full h-1/3 flex justify-center items-center text-lg sm:text-xl md:text-4xl font-bold rounded-lg">RONDE 1</div></div>
                            <div class="col-span-2 bg-blue-600 h-full flex justify-center items-center rounded-lg"><span class="text-6xl sm:text-8xl md:text-9xl font-black">${totalBiru}</span></div>
                            <div class="col-span-3 h-full flex justify-around items-center bg-black border-2 border-white rounded-lg p-2">${this.renderPenaltyIcons(penalties.biru)}</div>
                        </div>
                        <div class="grid grid-cols-11 text-center my-2 md:my-4 gap-2 text-xs sm:text-lg md:text-2xl">
                            <div class="col-span-5 bg-black border-2 border-white p-2 rounded-lg"><span>Juri: <strong>J1 J2 J3</strong></span></div>
                            <div class="col-span-1"></div>
                            <div class="col-span-5 bg-black border-2 border-white p-2 rounded-lg"><span>Juri: <strong>J1 J2 J3</strong></span></div>
                        </div>
                        <div class="w-full text-center py-2 text-6xl sm:text-7xl md:text-8xl font-black border-t-2 border-white mt-auto">${minutes}:${seconds}</div>
                    </div>
                    <style>@keyframes marquee {0% { transform: translateX(100%); } 100% { transform: translateX(-150%); } } .animate-marquee { display: inline-block; padding-left: 100%; animation: marquee 15s linear infinite; }</style>
                `;
            },
            attachEventListeners() { const appContainer = document.getElementById('app'); appContainer.querySelectorAll('input, textarea').forEach(input => { input.addEventListener('input', (e) => { const keyPath = e.target.dataset.key; if (keyPath) this.updateData(keyPath, e.target.value); }); }); appContainer.addEventListener('click', (e) => { const button = e.target.closest('button'); if (!button) return; const action = button.dataset.action; if (action) this.handleAction(action, button.dataset); }); },
            handleAction(action, dataset) {
                switch (action) {
                    case 'addOperator': const username = document.getElementById('newOpUsername').value; const pass = document.getElementById('newOpPass').value; if (username && pass) { this.data.users.operators.push({ username, pass }); this.saveAndRender(); } else { alert('Username dan password tidak boleh kosong.'); } break;
                    case 'deleteOperator': if (confirm('Anda yakin ingin menghapus operator ini?')) { this.data.users.operators.splice(dataset.index, 1); this.saveAndRender(); } break;
                    case 'timerPlay': this.timerPlay(); break;
                    case 'timerPause': this.timerPause(); break;
                    case 'timerReset': this.timerReset(); break;
                    case 'setCustomTime':
                        const customMinutes = parseInt(document.getElementById('customMinutes').value) || 0;
                        const customSeconds = parseInt(document.getElementById('customSeconds').value) || 0;
                        const newTotalSeconds = (customMinutes * 60) + customSeconds;
                        if (newTotalSeconds >= 0) {
                            this.data.timer.initialTime = newTotalSeconds;
                            this.timerReset();
                        } else {
                            alert('Waktu tidak valid.');
                        }
                        break;
                    case 'resetAll': if (confirm('Anda yakin ingin mereset seluruh pertandingan? Skor dan status akan kembali ke awal.')) { this.resetMatch(); this.saveAndRender(); } break;
                    case 'addScore': this.data.scores[dataset.juri][dataset.pesilat] += parseInt(dataset.value); this.saveAndRender(); break;
                    case 'dewanAction': 
                        const actionData = { type: dataset.type, pesilat: dataset.pesilat, timestamp: new Date().toISOString(), verified: false, forwardToKetua: false, juriVotes: { juri1: null, juri2: null, juri3: null } }; 
                        this.data.dewan.lastAction = actionData; 
                        this.saveAndRender(); 
                        
                        setTimeout(() => {
                            if (this.data.dewan.lastAction && this.data.dewan.lastAction.timestamp === actionData.timestamp) {
                                if (Object.values(this.data.dewan.lastAction.juriVotes).includes(null)) {
                                    this.data.dewan.lastAction.forwardToKetua = true;
                                    this.saveAndRender();
                                } else {
                                    this.data.dewan.lastAction.verified = true;
                                    setTimeout(() => { this.data.dewan.lastAction = null; this.saveAndRender(); }, 10000);
                                    this.saveAndRender();
                                }
                            }
                        }, 3000);
                        break;
                    case 'juriVerifyDewan':
                        if (this.data.dewan.lastAction) {
                            this.data.dewan.lastAction.juriVotes[dataset.juri] = dataset.vote;
                            this.saveAndRender();
                        }
                        break;
                    case 'verifyDewanAction': 
                        if (this.data.dewan.lastAction) {
                            this.data.dewan.lastAction.verified = true;
                            if (this.data.dewan.lastAction.type === 'Diskualifikasi') {
                                const disqualifiedPesilat = this.data.dewan.lastAction.pesilat;
                                this.data.ketua.winner = (disqualifiedPesilat === 'merah') ? 'biru' : 'merah';
                                this.timerPause();
                            }
                            setTimeout(() => { this.data.dewan.lastAction = null; this.saveAndRender(); }, 10000);
                            this.saveAndRender();
                        } 
                        break;
                    case 'setWinner': if (confirm(`Anda yakin ingin menetapkan ${dataset.winner.toUpperCase()} sebagai pemenang?`)) { this.data.ketua.winner = dataset.winner; this.timerPause(); this.saveAndRender(); } break;
                    case 'addPeserta': const name = document.getElementById('pesertaName').value; const perguruan = document.getElementById('pesertaPerguruan').value; if (name && perguruan) { this.data.pesertaList.push({ name, perguruan }); this.saveAndRender(); } break;
                    case 'deletePeserta': this.data.pesertaList.splice(dataset.index, 1); this.saveAndRender(); break;
                    case 'acakPertandingan': this.acakPertandingan(); break;
                    case 'closeWinner': this.resetMatch(); this.saveAndRender(); break;
                    case 'toggleFullscreen': this.toggleFullscreen(); break;
                }
            },
            saveData() { localStorage.setItem('silat_livescore', JSON.stringify(this.data)); },
            loadData() { const savedData = localStorage.getItem('silat_livescore'); if (savedData) { const parsedData = JSON.parse(savedData); this.data = { ...this.data, ...parsedData }; } },
            saveAndRender() { this.saveData(); this.render(); },
            updateData(keyPath, value) { let current = this.data; const keys = keyPath.split('.'); keys.forEach((key, index) => { if (index === keys.length - 1) current[key] = value; else current = current[key]; }); this.saveData(); },
            timerPlay() { if (this.data.timer.isRunning) return; this.data.timer.isRunning = true; this.data.timer.intervalId = setInterval(() => { if (this.data.timer.time > 0) { this.data.timer.time--; this.saveAndRender(); } else { this.timerPause(); } }, 1000); this.saveAndRender(); },
            timerPause() { clearInterval(this.data.timer.intervalId); this.data.timer.isRunning = false; this.saveAndRender(); },
            timerReset() { this.timerPause(); this.data.timer.time = this.data.timer.initialTime; this.saveAndRender(); },
            resetMatch() { this.timerPause(); this.data.timer.time = this.data.timer.initialTime; this.data.scores = { juri1: { merah: 0, biru: 0 }, juri2: { merah: 0, biru: 0 }, juri3: { merah: 0, biru: 0 } }; this.data.dewan = { lastAction: null, history: [] }; this.data.ketua.winner = null; this.saveAndRender(); },
            acakPertandingan() { if (this.data.pesertaList.length < 2) { alert('Tidak cukup peserta untuk diacak. Tambahkan minimal 2 peserta.'); return; } if (!confirm('Ini akan mengganti pesilat saat ini. Lanjutkan?')) return; let shuffled = [...this.data.pesertaList].sort(() => 0.5 - Math.random()); const pesilat1 = shuffled[0]; const pesilat2 = shuffled[1]; this.resetMatch(); this.data.match.pesilatMerah = pesilat1; this.data.match.pesilatBiru = pesilat2; this.data.match.name = `Pertandingan antara ${pesilat1.name} vs ${pesilat2.name}`; this.saveAndRender(); alert(`Pertandingan baru telah diatur:\nMERAH: ${pesilat1.name}\nBIRU: ${pesilat2.name}`); },
            toggleFullscreen() {
                const elem = document.getElementById('fullscreen-container');
                if (!document.fullscreenElement) {
                    if (elem.requestFullscreen) {
                        elem.requestFullscreen();
                    } else if (elem.webkitRequestFullscreen) { /* Safari */
                        elem.webkitRequestFullscreen();
                    } else if (elem.msRequestFullscreen) { /* IE11 */
                        elem.msRequestFullscreen();
                    }
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    }
                }
            }
        };
        App.init();
    </script>

</body>
</html>

